<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SAS III - Still Alive Somehow??</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: #000;
        }
        #glcanvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="glcanvas" tabindex='1'></canvas>
    <script>
        (function() {
            const originalAlert = window.alert;
            window.alert = function(message) {
                if (typeof message === 'string' && 
                    (message.includes('WEBGL_depth_texture') || 
                     message.includes('OES_vertex_array_object'))) {
                    console.warn('[WebGL Extension]', message);
                    return;
                }
                originalAlert.call(window, message);
            };
            
            const glcanvas = document.getElementById('glcanvas');
            const origGetContext = glcanvas.getContext;
            glcanvas.getContext = function(contextType, contextAttributes) {
                if (contextType === 'webgl' || contextType === 'experimental-webgl') {
                    console.log('[WebGL] Requesting WebGL 2.0');
                    const gl2 = origGetContext.call(this, 'webgl2', contextAttributes);
                    if (gl2) {
                        console.log('[WebGL] Using WebGL 2.0');
                        return gl2;
                    }
                    console.log('[WebGL] Falling back to WebGL 1.0');
                }
                return origGetContext.call(this, contextType, contextAttributes);
            };
            
            glcanvas.focus();
        })();
    </script>
    <script src="https://not-fl3.github.io/miniquad-samples/mq_js_bundle.js"></script>
    <script>
        (function() {
            const origLoad = window.load;
            window.load = function(wasmPath) {
                const origImportObject = window.importObject || {};
                
                if (!window.importObject) {
                    window.importObject = {};
                }
                if (!window.importObject.env) {
                    window.importObject.env = {};
                }
                
                const glCtx = document.getElementById('glcanvas').getContext('webgl2');
                
                window.importObject.env.glCheckFramebufferStatus = function(target) {
                    if (glCtx) {
                        return glCtx.checkFramebufferStatus(target);
                    }
                    return 0x8CD5;
                };
                
                window.importObject.env.glRenderbufferStorageMultisample = function(target, samples, internalformat, width, height) {
                    if (glCtx && glCtx.renderbufferStorageMultisample) {
                        glCtx.renderbufferStorageMultisample(target, samples, internalformat, width, height);
                    }
                };
                
                window.importObject.env.glDeleteRenderbuffers = function(n, renderbuffers) {
                    if (glCtx) {
                        for (let i = 0; i < n; i++) {
                            const rb = renderbuffers + i * 4;
                            glCtx.deleteRenderbuffer(rb);
                        }
                    }
                };
                
                window.importObject.env.glFramebufferRenderbuffer = function(target, attachment, renderbuffertarget, renderbuffer) {
                    if (glCtx) {
                        glCtx.framebufferRenderbuffer(target, attachment, renderbuffertarget, renderbuffer);
                    }
                };
                
                window.importObject.env.glReadBuffer = function(mode) {
                    if (glCtx && glCtx.readBuffer) {
                        glCtx.readBuffer(mode);
                    }
                };
                
                window.importObject.env.glBlitFramebuffer = function(srcX0, srcY0, srcX1, srcY1, dstX0, dstY0, dstX1, dstY1, mask, filter) {
                    if (glCtx && glCtx.blitFramebuffer) {
                        glCtx.blitFramebuffer(srcX0, srcY0, srcX1, srcY1, dstX0, dstY0, dstX1, dstY1, mask, filter);
                    }
                };
                
                return origLoad.call(this, wasmPath);
            };
        })();
    </script>
    <script>
        load("sas.wasm");
    </script>
</body>
</html>

